---
title: "Tadpole Mortality"
subtitle: "Métodos Analíticos"
editor: visual
authors:
  - "Mario Medina - 156940"
  - "José Eduardo Gutierrez - "
  - "Mariano Villafuerte - 156057"
format: 
    html:
      toc: TRUE
      embed-resources: TRUE
      theme: flatly
      lang: es
      font-size: 1.1em
      include-in-header: 
      - text: |
          <style>
            body { 
              line-height: 2; /* Adjust the value as needed */
            }
          </style>
---

```{r librerias}
#| echo: FALSE
#| message: FALSE
#| warning: FALSE

# librerias ----
library(cmdstanr)
library(coda)
library(dagitty)
library(DiagrammeR)
library(loo)
library(mvtnorm)
library(rethinking)
library(scales)
library(shape)
library(tidyverse)

# configuracion de ggplot ----
theme_set(theme_minimal())

# cargamos los datos de reedfrogs ---
data(reedfrogs)
```

## Problema {#sec-problema}

En nuestro proyecto, utilizamos datos del estudio de Vonesh, J. R. y Bolker, B. M. (2005), el cual examina cómo las ranas de junco del este de África (Hyperolius spinigularis) adaptan sus tiempos de eclosión en respuesta a los depredadores. Este estudio original mostró que, a pesar de las expectativas, las larvas que eclosionaron temprano por presión de los depredadores no solo sobrevivieron, sino que lo hicieron mejor que las larvas de nidadas no perturbadas. Estos hallazgos sugieren que los costos y beneficios asociados con la plasticidad en la eclosión pueden no ser tan directos como se pensaba anteriormente.

Nuestro proyecto toma estos datos y resultados para construir un modelo Bayesiano jerárquico. El objetivo es profundizar en la comprensión de cómo las respuestas compensatorias de las larvas pueden alterar los compromisos tradicionalmente asociados con la plasticidad de eclosión inducida por depredadores. El modelo que desarrollamos intenta capturar la dinámica de crecimiento compensatorio y las tasas de depredación específicas de tamaño y densidad que pueden explicar mejor las altas tasas de supervivencia observadas en las larvas eclosionadas temprano. Nuestros análisis proporcionan una perspectiva más matizada sobre cómo las decisiones de eclosión temprana influyen en la supervivencia y el desarrollo posterior de las ranas, indicando que los verdaderos costos de estas decisiones emergen más adelante en la vida de las larvas.

Este enfoque modela matemáticamente las interacciones complejas y ofrece nuevas vías para entender las estrategias adaptativas en anfibios frente a amenazas ambientales.

## Datos {#sec-datos}

Utilizamos el conjunto de datos de *reedfrogs* disponible en la librería de *rethinking*. Las instrucciones para instalar la librería y cargar los datos están disponibles en el Anexo 1: *Rethinking y sus datos*.

Para este problema contamos inicialmente con 5 variables:

| Variable | Descripción                                   |
|----------|-----------------------------------------------|
| density  | Densidad inicial de renacuajos                |
| pred     | Factor indicador de presencia de depredadores |
| size     | Factor del tamaño de los renacuajos           |
| surv     | Número de renacuajos que sobrevivieron        |
| propsurv | Proporción de supervivencia                   |

El conjunto de datos cuenta con información de 48 tanques clasificados en pequeños, medianos y grandes, dependiendo de la densidad de renacuajos en cada uno. Además, disponemos de datos sobre la supervivencia y la tasa de supervivencia en cada tanque.

```{r}
#| echo: FALSE
df <- reedfrogs

# Add an index column to the data frame
df$index <- seq.int(nrow(df))

# Calculate the mean of propsurv
mean_propsurv <- mean(df$propsurv)
```

```{r scatter1}
#| echo: FALSE
# Create the scatterplot with annotations
p <- ggplot(df, 
            aes(x = index, 
                y = propsurv)) +
  geom_point() +
  geom_hline(yintercept = mean_propsurv, 
             linetype = "dashed", 
             color = "blue4") +
  annotate("text", 
           x = max(df$index) - 23, 
           y = mean_propsurv + 0.05, 
           label = "Promedio de supervivencia en tanques", 
           color = "grey", fontface = "italic", hjust = 0) +  
  labs(x = "Tanque", y = "Tasa de Supervivencia") +
  theme(
    axis.title.x = element_text(face = "italic"),
    axis.title.y = element_text(face = "italic")) +
  scale_x_continuous(breaks = c(8, 24, 40), 
                     labels = c("1 <= Pequeño < 16", 
                                "16 <= Mediano < 32", 
                                "32 <= Grande < 48")) +
  geom_vline(xintercept = 16, 
             color = "cyan3")+
  geom_vline(xintercept = 32, 
             color = "cyan3")+
  geom_vline(xintercept = 48, 
             color = "cyan3") +
  scale_y_continuous(labels = scales::percent_format())

p
```

Hay mucha variación en estos datos. Parte de la variación proviene del tratamiento experimental, pero mucha también proviene de otras fuentes. Pensemos en cada fila como un “tanque,” un entorno experimental que contiene renacuajos. Hay muchas cosas peculiares de cada tanque que no se miden, y estos factores no medidos crean variación en la supervivencia entre tanques, incluso cuando todas las variables predictoras tienen el mismo valor. Se realizan múltiples observaciones, en este caso los renacuajos, dentro de cada grupo

## Modelo

El modelo jerárquico que proponemos pretende capturar estas complejas interacciones entre la densidad, la tasa de supervivencia y otros factores clave para proporcionar una comprensión más profunda de las estrategias adaptativas de las ranas frente a las amenazas de los depredadores.

```{r}
#| echo: FALSE
grViz("
digraph {
  graph [ranksep = 0.2, rankdir=LR]
  node [shape=plaintext]
    S
    T
    D
    G
    P
  edge [minlen = 5]
   T -> S
   D -> S
   G -> S
   P -> S
}
", width = 150, height = 60)
```

Con

-   $\textrm{T}=\textrm{Tanque}$

-   $\textrm{D}=\textrm{Densidad inicial}$

-   $\textrm{G}=\textrm{}$

-   ${P}=\textrm{Depredadores}$

-   $\textrm{S}$

\newpage

## Anexos {#sec-anexos}

### Rethinking y sus datos {#sec-rethinking-y-sus-datos}

Para instalar la librería de *rethinking*, se pueden seguir las instrucciones del repositorio de McElreath, disponible en este [link](https://github.com/rmcelreath/rethinking "Repositorio de rethinking").

Una vez instalada la librería y sus dependencias, los datos de *reedfrogs,* basta con correr el siguiente código

```{r anexo1_cargarDatos, eval=FALSE}
library(rethinking)
data(reedfrogs)
```
